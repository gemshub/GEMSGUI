<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
                
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
                
  <meta name="GENERATOR"
 content="Mozilla/4.72 [en] (Win98; I) [Netscape]">
  <title>GEM-Selektor Tutorial</title>
                    
  <meta name="description" content="Version 2.0.0-PSI">
</head>
  <body>
       
<h1><img src="gems1.png" height="48" width="48" align="left">
    <font color="#000066">GEM-Selektor version 2-PSI</font></h1>
       
<h2><font size="+2">Tutorial Guide</font></h2>
     
<hr width="100%" size="2">   
<h3>Contents </h3>
     
<p>&nbsp; <br>
&nbsp;Under Construction<br>
</p>
<p>To be provided in Version 2.2<br>
</p>
<hr width="100%" size="2">
<p>   &nbsp; </p>
     
<p>Tutorial </p>
     
<p>Index <br>
   &nbsp;<br>
   <br>
   </p>
     
<p>Example 10 from the PHREEQC2 User's   Guide <a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#1999PARAPP">[1999PAR/APP]</a> 
 which should  help you to compare the results obtained by using the alternative
  Law-of-Mass  Action (LMA) and Gibbs Energy Minimization (GEM) techniques
 and to better understand  their common features and differences. <br>
   </p>
     
<p><br>
  </p>
   
<p><br>
  </p>
   
<p> &nbsp; </p>
                    
<h4> <a name="3_1_1_open_profile"></a>3.1.1 Opening a System Profile</h4>
                       
<p><br>
          To start chemical modeling calculations in GEMS means to open a 
system    profile.  Just press the&nbsp; <tt><font size="+1">"</font>Computation
 of   Equilibria<font size="+1">"</font></tt>&nbsp; button on the Main Dialog.
   A <font size="+1">"</font>System Profile<font size="+1">"</font> dialog
 will   appear  with a list of available <a
 href="file:///C:/GEMS2test/program/doc/html/gm_profil.html">profile definitions</a>. 
    <br>
          &nbsp; </p>
                    
<p>One of the listed profiles is named "Default", it contains lists of all
     the phases and components necessary for our worked example. Select it
 with    a left mouse click and then press <tt><font size="+1">"</font>Go!<font
 size="+1">"</font></tt> button to open the profile. In a few seconds, you
     will see a&nbsp; <tt><font size="+1">"</font></tt>Computation of Geochemical
     Equilibrium Models<tt><font size="+1">"</font></tt> dialog. <br>
          &nbsp; </p>
                    
<p>Three wide buttons on this dialog (<tt><font color="#000000">SysEq,Process</font></tt> 
     and <tt>GtDemo</tt>) correspond to three main modes of geochemical modeling 
     available in this version of GEMS. Any modeling exercise starts with 
construction     of at least one single chemical system definition (CSD), 
which can then   be used as a template for creating other similar definitions, 
or as a startpoint     for the process simulation. <br>
          &nbsp; </p>
                    
<p>So, we have to create a new system definition to model solubility of (Ca,Sr)CO<sub>3</sub>
     solid solution in water under CO<sub>2</sub> atmosphere. To do this,
press     the <tt>"Single - System Equilibria (SysEq)"</tt>&nbsp; button
on the&nbsp;     "Computation..." dialog. <br>
          &nbsp; <br>
          &nbsp; </p>
                    
<h4> 3.1.2 Setting up bulk composition of the chemical system</h4>
                       
<p><br>
          &nbsp;Now, you are in the "Single Thermodynamic System" dialog
that   provides   easy access to various input data screen forms related
to chemical   system   definitions, as well as to the equilibrium calculation
results.  Both kinds   of data for a single chemical system are stored in
the database  as one record   of&nbsp; <tt><a
 href="file:///C:/GEMS2test/program/doc/html/gm_syseq.html">SysEq</a></tt>&nbsp; 
 type under a unique   <a
 href="file:///C:/GEMS2test/program/doc/html/gdb_rkey.html#dbm_SysEq">record
 key</a>. <br>
          &nbsp; </p>
                    
<p>A top left button group called&nbsp; "Records"&nbsp; helps you to manage 
     SysEq records. To set up a new chemical system definition means to insert 
     a new record in the database, and this process always begins with creation 
     of a new SysEq record key. So, proceed by doing a left mouse click on 
 the    <tt>"Create..."</tt> button in the "Records" button group. <br>
          &nbsp; </p>
                    
<p>A small but important dialog "SysEq: Please, enter a new record key" appears
     now. It has eight text editor lines, each corresponding to a field in
 SysEq    record key format. You will see tool tips which tell you the maximum
 length    and the meaning of each field, if you keep the mouse cursor on
a field for   more than 2 seconds. Clicking on the <tt>"Help"</tt> button
will open HTML   page with more information, if necessary (don't forget to
step back to the   present page in Helpviewer window). <br>
          &nbsp; </p>
                    
<p>The first (top) field always contains the System Profile name and must 
     not be edited - any chemical system definition (CSD) is meaningful only 
   within the profile context where it was created. <br>
          &nbsp; </p>
                    
<p>The second field shows which potential function will be minimized (this 
     version of GEMS can minimize Gibbs energy only), type <tt>'G'</tt> in. 
  <br>
          &nbsp; </p>
                    
<p>The third field should keeps an identification name of the chemical system
     (up to 12 characters long); enter <tt>'CaCO3_AQ'</tt> there (assume
you've      just invented this name for a new system). <br>
          &nbsp; </p>
                    
<p>The fourth field is necessary to keep track of changing bulk composition 
     of otherwise the same chemical system. It must contain a non-negative 
 integer    made of one to five digits - the bulk composition and configuration 
 (BCC)    variant number. Enter&nbsp; <tt>'1'</tt>&nbsp; there - it is your 
 first  system!  <br>
          &nbsp; </p>
                    
<p>The fifth field may contain volume constraint for the system (for some 
     special systems), but now put '0' to tell the program that the volume 
 is   unconstrained.  <br>
          &nbsp; </p>
                    
<p>The sixth field must contain pressure <i>P</i>&nbsp; (in bars) or 0 (then
     pressure <i>P<sub>sat</sub></i>&nbsp; will be computed from temperature
   along  the saturated vapor curve SVC); enter <tt>'1'</tt> to set the ambient
   pressure  1 bar. <br>
          &nbsp; </p>
                    
<p>The seventh field must contain non-negative temperature <i>TC</i>&nbsp; 
     (in Centigrade); enter <tt>'25'</tt> to set the ambient temperature. 
<br>
          &nbsp; </p>
                    
<p>The eight and last field must contain a variant number of kinetic or other
     CSD constraints of otherwise the same chemical system. Now, enter <tt>'0'</tt>
     into this field. <br>
          &nbsp; </p>
                    
<p>So far, the "SysEq: Please, enter a new record key" dialog should look 
     like this: <br>
          &nbsp; </p>
                    
<p><img src="file:///C:/GEMS2test/program/doc/html/syseqkey.png"
 nosave="" height="242" width="328" align="left">
           <br>
          &nbsp; </p>
                    
<p>The packed key of this SysEq record will look like this:&nbsp; <tt>"Default:G:CaCO3_AQ:1:0:1:25:0:"<font
 size="+1">. </font></tt>Now, press the <tt>"Ok"</tt> button. In a small
"Reallocation of data arrays" dialog, you will see the above packed key of
the record about to be created. Press the <tt>"Clear all"</tt> button because
the first definition of the chemical system has to be created "from scratch".
 Activation of the <tt>"Clear all"</tt> button forces the program to fill
out all fields of SysEq records with default values and delete all dynamic-memory
 data fields (if there were any). In contrast, the <tt>"Remake"</tt> button
 retains all the information present in the SysEq data structures and lets
 you re-organize it. The <tt>"Bypass" </tt>button (pressed in most cases)
retains previous data and skips the whole remake process. <br>
          &nbsp; </p>
                    
<p>Pressing <tt>"Clear all" </tt>will pop up a configuration dialog called 
     "SysEq: Remake parameters", with many switches and counters (don't change 
     anything in them for this example calculation). Above the <tt>"Ok"</tt> 
   button, there are three string fields. The upper one is called <tt>"tname"</tt> 
   and it is advisable to enter there a few words for identification of this 
   chemical system definition. For instance,&nbsp; type <tt>"My first aragonite- 
   water-atmosphere system"<font size="+1"> </font></tt>(don't forget first 
  to remove the "Empty" placeholder <tt><font size="+1">`</font></tt>). The 
  line below - <tt>"tnote"</tt> - may contain some comments to the first line,
  for instance, your name. Or, better, type <tt>"Following Example 10 from
 PHREEQC2"</tt>.&nbsp; Leave third line (<tt>"tPhEQ"</tt>) blank and press
 the <tt>"Ok"</tt>&nbsp; button. <br>
          &nbsp; </p>
                    
<p>After a few seconds (when the GEMS code configures memory and collects 
     thermodynamic data from the database files), you will see a "Compos" 
page     of the "System::" screen form. Except of two lines of text you just 
typed     in before, this page shows a list of <a
 href="file:///C:/GEMS2test/program/doc/html/gm_compos.html">predefined 
  composition objects</a> (Compos record keys) which you can, optionally, 
  use  for constructing the bulk composition of your system. <br>
          &nbsp; </p>
                    
<p>Left mouse clicking on any of the page selector buttons in the window top
left corner will show you other pages with lists of accessible record keys
and (input) data for the species (<tt>"DComp"</tt> button), phases (<tt>"Phase"</tt>
     button ), and stoichiometry units (<tt>"IComp"</tt> button). <br>
          &nbsp; </p>
                    
<p>Contents of any input data record accessible to this system profile will
     be shown in a separate window if you click on the respective list item
  and   then press&nbsp; <tt>F7</tt>&nbsp; key (close such windows after
looking     into them). Pressing <tt>F1</tt> key after clicking on any&nbsp;
data field    will show you the appropriate HTML documentation page. All
the data fields    show tool tips, also visible (after a mouse click) with
data object label    and cell indices in the bottom (status) line of the
window. <br>
          &nbsp; </p>
                    
<p>Now, let's get back to our <a
 href="file:///C:/GEMS2test/program/doc/html/KSExamp/casrco3.html">modeling
 example</a>.     The initial composition of aqueous phase is defined as
calcium  bicarbonate     solution at equilibrium with pure aragonite at nearly
1 bar  partial pressure     of CO<sub>2</sub> gas. The easiest way to set
such a  composition is to  take  1 kg of water, 1 mole of CO<sub>2</sub>,
and 1 mole  of CaCO<sub>3</sub>,    and let it equilibrate (in absence of
other solid  phases except aragonite)    at 1 bar and 25 C. <br>
          &nbsp; </p>
                    
<p>Go to "DComp" page of "System" window and scroll down the "DCvp" list until
you find the water solvent (<tt>"a&nbsp;&nbsp; Zw_&nbsp;&nbsp;&nbsp;&nbsp; 
     H2O@&nbsp;&nbsp;&nbsp; "</tt> record key). In a cell to the right, change 
     "M" to "g" to set gram units, and in the next cell to the right ( in 
<tt>"xd_"</tt>     column), enter "1000". This will add 1 kg of H<sub>2</sub>O 
stoichiometry     to the bulk composition of the system. <br>
          &nbsp; </p>
                    
<p>Down in the "DCvp" list, find the record key of CO<sub>2</sub>&nbsp; gas
     (<tt>"g&nbsp;&nbsp; C+4&nbsp;&nbsp;&nbsp;&nbsp; CO2&nbsp;&nbsp;&nbsp;
 "</tt>),    and put "1" in the corresponding cell of the&nbsp; <tt>"xd_"</tt>
 vector.    The (unchanged) <tt>'M'</tt> code to the left tells you that
you  are adding    one mole of CO<sub>2</sub> stoichiometry to the bulk composition;
 other  useful  <a
 href="file:///C:/GEMS2test/program/doc/html/g_useref.html#QUANCONCUNITS">"quantity-concentration"
 codes</a>   are <tt>'g'</tt> (grams), <tt>'m'</tt> (molality), <tt>'i' </tt>(millimolality) 
     and <tt>'%'</tt> (mass percent).&nbsp; In the same way, put 1e-4 moles 
  of  O<sub>2</sub> stoichiometry to set up redox state of the system (assumed 
    to be slightly oxidizing). <br>
          &nbsp; </p>
                    
<p>Finally, go up the "DCvp" list, find&nbsp; <tt>"a&nbsp;&nbsp; Ca&nbsp;&nbsp;&nbsp; 
     Ca(CO3)@&nbsp;&nbsp; "</tt>&nbsp; entry and put <tt>'1'</tt> into the 
 respective    cell of the&nbsp; <tt>"xd_"</tt> vector to the right, to add 
 1 mole of CaCO<sub>3</sub>&nbsp;  to the bulk composition of the system. 
Please, note that we add here 1 mole  of stoichiometry of the neutral CaCO<sub>3</sub> 
  aqueous species; we could  also use the dependent component aragonite to 
 do this. In any case, non-zero  numbers in <tt>"xd_"</tt> vector do not prescribe
  that the respective DCs  must appear at equilibrium; this can be decided
 only upon completion of the  GEM calculation. <br>
          &nbsp; </p>
                    
<p>Now, select the "IComp" page of "System" window. You will see a scroll 
     list <tt>"ICvp"</tt> of accessible independent components and a <tt>"B_"</tt> 
     vector-column tied to <tt>"ICvp"</tt> on the right side. The <tt>"B_"</tt> 
     vector still contains only zeros, which means that the input bulk composition 
     of the system has not yet been calculated. To do it, find the GEMS&nbsp; 
    "Single Thermodynamic System" dialog on your desktop and press a large 
 "BCC"   button, located in "Calculations" button group at the bottom right 
 corner   of the dialog window. <br>
          &nbsp; </p>
                    
<p>After one or two seconds, you should see the "IComp" page of "System" window
and in the middle of it - a lengthy but important dialog shown below: <br>
          &nbsp; </p>
                    
<p><img src="file:///C:/GEMS2test/program/doc/html/bcccheck.png"
 nosave="" height="291" width="494">
           <br>
          &nbsp; </p>
                    
<p>Put mouse pointer on the title of this dialog (where you see the record 
     key of SysEq record to be created) and drag it away to see contents of
  the  <tt>"B_"</tt> vector-column. The program calculated 2 moles of carbon,
  1 mole of calcium, 111.01687 moles of hydrogen, and 60.508434 moles of
oxygen;    the remaining cells (for other chemical elements) contain zeros. 
<br>
          &nbsp; </p>
                    
<p>Since zero or negative quantities of independent components cannot be considered
in calculation of equilibria, the above dialog reports you about this situation
and suggests that it will automatically switch off all such IC, all species
containing them, and all (single component) phases referring to those species.&nbsp;
Look at the leftmost column on the "IComp" page: the independent components
prepared to be switched off are now marked with asterisks <tt><font
 size="+1">'*'</font></tt>, and those about to be retained - with pluses
<tt><font size="+1">'+'</font></tt>. <br>
          &nbsp; </p>
                    
<p>The program cannot decide for you - you might have forgotten to add some
     ingredients to the system composition (in principle, you can find it
out    by examining the <tt>"B_"</tt> vector or its switch list). An alternative
     is to fill zero elements of the <tt>"B_"</tt> vector with "trace" values,
     and then re-examine how your bulk composition is specified. Do not try
  to  calculate the equilibrium if the above diagnostic message appears after
  pressing  the <tt>"BCC"</tt> button! <br>
          &nbsp; </p>
                    
<p>In case of our example, obviously, the rest of independent components can
be safely switched off, so press <tt>Enter</tt> or click on the <tt>"EXCLUDE"</tt> 
     button. You will see minuses against all the discarded ICs, which means 
   that they will not be taken into the chemical system definition to calculate 
   the equilibrium state. <br>
          &nbsp; </p>
                    
<p>Now, Select the "Phase" page. You will see a (more or less) long list of
phases (Phase record keys) linked to the system profile, and also a switch
     list to the left, with all phases that do not conform to the bulk composition
     already switched off. In the list, aqueous phase is always the first
one,     followed by the gas phase. Next to the gas phase, other multi-component
   phases  are listed (solid solution, sorption etc.), followed by single
component    phases. This order is required by the GEM IPM numerical kernel
of Selektor    codes. <br>
          &nbsp; </p>
                    
<p>Some of the phases, e.g. <tt>"Ca-stronti-sub"</tt> (Ca-strontianite solid
     solution) are still switched on; obviously, in the present example,
you    have  to switch them off by hand (just typing in minuses instead of
pluses    in the  selection column). By doing so, make sure that the following
phases    remain  switched on: </p>
                    
<ul>
    <li> <tt><font size="+1">aq_gen</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
     (generic aqueous electrolyte phase)</li>
    <li> <tt><font size="+1">gas_gen</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
     (generic ideal gas mixture)</li>
    <li> <tt><font size="+1">Graphite</font></tt></li>
    <li> <tt><font size="+1">Aragonite</font></tt></li>
    <li> <tt><font size="+1">Portlandite</font></tt></li>
   
</ul>
                       
<p><br>
          Select now the "DComp" page. You will also see a list of all species
   available   to the system profile, arranged according to the order of
phases    in the list  on "Phase" page. Number of species in each phase is
provided    in the <tt>"L1vp"</tt>  column on the "Config" page; you can
use this information    to locate species  of a given phase in the <tt>"DCvp"</tt>
list. Hydrogen    ion and water solvent  always stay at the end of species
list in the aqueous    phase. For such examples  like the present one, it
is advisable to switch    off&nbsp; H<sub>2</sub>O gas from the gas phase
- then the amount of aqueous    phase at equilibrium will not depend on mass
ratio of gas to aqueous phase.    Just scroll the <tt>"DCvp"</tt>  list until
you find the <tt>"g:O-2:H2O:   "</tt> species and put <tt><font
 size="+1">'-'</font></tt>&nbsp; instead  of <tt><font size="+1">'+'</font></tt>
 against it. <br>
          &nbsp; </p>
                    
<p>Now, go back to the "IComp" page, then to the "Single Thermodynamic System"
     dialog on your desktop, and press the <tt>"BCC"</tt> button again. If,
  after   1-2 seconds, the "Switch off" warning dialog does not appear, then
  your system  definition is internally consistent and ready for calculation
  of equilibrium  state. Otherwise, check what's wrong in the System window
  pages, make corrections  and press the <tt>"BCC"</tt> button again. Close
  the "System" window by pressing  the "Close" button, when finished. <br>
          &nbsp; <br>
          &nbsp; </p>
                    
<h4> 3.1.3 Running GEM IPM to obtain equilibrium  speciation</h4>
                       
<p><br>
          Go into the "Single Thermodynamic System" dialog. Make sure that
 the   <tt>"Simplex"</tt>   check box is ticked, and left-click the large
<tt>"IPM</tt>"   button. This   will create an IPM internal data structure
and submit it into  the GEM IPM   numerical module for calculation of equilibrium
state in the  "Automatic Initial  Approximation" mode. When the IPM starts,
you will see  an "IPM Minimization   Progress" dialog. It shows some (periodically
 updated)  vital information,   such as the key of currently loaded SysEq
record where  the results will be  stored&nbsp; (in this case, <tt>"Default:G:CaCO3_AQ:1:0:1:25:0:"</tt>);
   the  number of performed IPM iterations; basic information about the chemical 
    system (total masses of gas, liquid and solid phases in grams; pH, pe 
and    IS of the aqueous electrolyte phase). <br>
          &nbsp; </p>
                    
<p>When calculation of equilibrium is finished (usually in less than 1 sec),
     the "Single Thermodynamic System" dialog will show a word "Converged..." 
    in the title and two buttons <tt>"Accept"</tt> and <tt>"Discard"</tt> 
at   the bottom. Pressing the first (<tt>"Accept"</tt>) button will pack the
definition   of chemical system and results of calculation into SysEq record
and save  it into the database under the currently selected record key (just
do it now). The <tt>"Discard"</tt> button will get you back to the "Single
Thermodynamic   System" dialog without saving the results (for instance,
when such SysEq  record exists and something goes wrong with the last calculation).
The SysEq  record is saved also when you press the&nbsp; <tt>"Save"</tt>
button on the  "Single Thermodynamic System" dialog. <br>
          &nbsp; </p>
                    
<p>You can (if you like) immediately check how good is the equilibrium speciation
     that just has been&nbsp; calculated. Uncheck the "Simplex" check box
below     the "IPM" button and press this button again. This will run the
GEM IPM   module  using the previously calculated speciation as initial approximation.
   If you  see on the "Single Thermodynamic System" dialog that the program
  has converged  in 0 or 1 iterations and other numbers (e.g. pH) are the
same,    than the previously  calculated result was OK. Press the "Accept"
button   to save the results. <br>
          &nbsp; <br>
          &nbsp; </p>
                    
<h4> 3.1.4 Examining the results</h4>
                       
<p><br>
  </p>
   &nbsp;           
<p>There is a&nbsp; <a
 href="file:///C:/GEMS2test/program/doc/html/GEMS-Linux-USREF.html#P6880">Calculator</a>&nbsp; 
     widget which lets you do calculations "on the fly" (make sure that IPM 
  calculation  results are saved before doing this). For instance, go back 
 to the <tt>EqIC</tt>  page and click on the first cell of <tt>lgm_t</tt> 
column, then press <tt>F8</tt>.  A "Data Object Cell Calculator" widget will 
appear on your desktop. Click  on <tt>"Select all cells"</tt> button, then 
on <tt>"10^x"</tt> button, and  finally - on <tt>"Ok-Do It!"</tt>. The "Calculator" 
disappears, and you will  see total molalities instead of their logarithms 
in the&nbsp; <tt>lgm_t</tt>  column. Repeat the operation (selecting <tt>"log 
x"</tt> on the Calculator  widget) to restore the initial numbers in the<tt> 
lgm_t</tt> column. The <tt>F1, F7</tt> and <tt>F8</tt> hot key functionality 
can also be selected from a small pop-up menu when you do a right mouse click 
on any data field cell. <br>
          &nbsp; </p>
                  After you have finished examination of results, press <tt>"Close"</tt> 
     button to return to the "Single Thermodynamic System" dialog. From there 
    you may want to print the system definition and results of calculation 
 of   equilibrium state into a text ASCII file. In this case, click on any 
 of the  buttons in the "Print/Export" group (bottom right corner) and select 
  the file name and directory where to print the file in the appearing dialog. 
  <br>
          &nbsp; <br>
  <br>
                          
<h4> 3.1.5 Modifying chemical system definition</h4>
                     
<p><br>
         Compare pH=6.11 and total dissolved Ca=12.34 mmolal, calculated
in  the   previous  example, to that taken in the PHREEQC2 manual example
(pH=5.93,    total Ca = 3.932 mmolal). We see that our pH is about 0.2 units
higher and   total dissolved  Ca&nbsp; - 3 times greater than in the original
example.    Could this difference  be related to different data in thermodynamic
database?    <br>
         &nbsp; </p>
                  
<p>Let us examine input thermodynamic data. On the "Single Thermodynamic
System" dialog, click a <tt>"Thermodynamic data at T, P"</tt> button in the
"Input..." group. A "MTparm" window appears with a large&nbsp; <tt>DCvp</tt>&nbsp;
list of Dependent Component record keys available to the system profile.
Drag the scroll bar near this list down until you see a record key <tt>"s:CaCO:aragonite:&nbsp;&nbsp;
     "</tt> and&nbsp; <tt>"s:CaCO:calcite:&nbsp;&nbsp; "</tt> immediately
next     to it. Click&nbsp; on the corresponding cell in a&nbsp; <tt>gTP</tt>
column     to the right of <tt>"s:CaCO:aragonite:&nbsp;&nbsp; "</tt> list
line. This     cell contains -1127400 (J/mol) - the standard state Gibbs
energy of aragonite,     taken into our equilibrium calculations. By clicking
on the record key  and  pressing <tt>F7</tt> you will see that the data for
aragonite comes from the [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1995ROB/HEM%5D">1995ROB/HEM</a>]
 database.    <br>
         &nbsp; </p>
                  
<p>Close this DComp window and, by scrolling <tt>DCvp</tt> list up, find
also <i>G</i><sup>o</sup> data for Ca<sup>+2</sup> (-552790) and CO<sub>3</sub><sup>-2</sup>
     (-527983 J/mol) aqueous ions. From these data one obtains that the actual
     thermodynamic solubility product of aragonite (log<i>K&nbsp; </i>= -8.169)
     is greater than that in the PHREEQC2 example (log<i>K&nbsp; </i>= -8.336)
     by 0.167 logK units. Therefore, to obtain the same solubility of aragonite
     as in the PHREEQC2 example, the standard state Gibbs energy of aragonite
    at 25 <sup>o</sup>C must be decreased by 0.167*5708 = 955 J/mol (from
-1127400     to -1128355 J/mol).. <br>
         &nbsp; </p>
                  
<p>Luckily, such trial corrections can be made in GEMS chemical system definitions, 
    without actual modification of thermodynamic database. Just get back to
  the  <tt>"s:CaCO:aragonite:&nbsp;&nbsp; " </tt>line which is located before&nbsp;
    <tt>"s:CaCO:calcite:&nbsp;&nbsp; "</tt> in the <tt>DCvp</tt> list and,
 in   the corresponding cell of a <tt>gEx_</tt> column to the right, type&nbsp;
    -955. Now, the&nbsp; <i>G<sup>0</sup></i>&nbsp;&nbsp; value of aragonite,
    actually taken into the IPM calculation, will be -1127400 + (-955) =
-1128355     J/mol, which corresponds to solubility product log<i>K&nbsp;</i> 
= -8.336,     as required. <br>
         &nbsp; </p>
                  
<p>What remains to do in order to see how this correction affects the equilibrium
     speciation and pH? Just close the MTparm window and press the large
"IPM"      button on the "Single Thermodynamic System" dialog - to calculate
the  equilibrium    again. Press "Accept" button on the IPM progress dialog
and  then examine   the results ("Dual Solution" button). <br>
         &nbsp; </p>
                  
<p>In the EqIC page of EqDemo window, the following total solubilities should 
    appear now: <br>
         &nbsp; <br>
         &nbsp;          
<table border="3" cellspacing="3" cellpadding="3">
          <tbody>
             <tr>
          <td><tt><font size="+1">ICnam</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
          <tt><font size="+1">lgm_t</font></tt></td>
          </tr>
           <tr>
          <td>C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     -1.26083</td>
          </tr>
           <tr>
          <td>Ca&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     -1.97559</td>
          </tr>
           <tr>
          <td>H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     -1.67493</td>
          </tr>
           <tr>
          <td>O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     -0.88324</td>
          </tr>
           <tr>
          <td>Zz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     0</td>
          </tr>
                                     
  </tbody>         
</table>
           </p>
                  
<p>The total dissolved calcium is now 10.58 mmolal, about 2 mmolal less than 
    that obtained with the uncorrected <i>G<sup>o</sup></i>&nbsp; of aragonite.
     Let us check the solubility product that actually has been used in the
  last  GEM calculation. Pick up the <tt>EqDC </tt>page and, in the <tt>lga</tt>
    column, find log activity of Ca<sup>+2</sup> ( -2.285) and that of CO<sub>3</sub><sup>-2</sup>&nbsp;
     ( -6.051). Their sum is quite close to&nbsp; -8.336 - the implied log<i>K</i>&nbsp;&nbsp;
     for aragonite.&nbsp; Go to the <tt>EqGen</tt> page and check the calculated
     pH there (6.047). This pH is slightly lower than in the previous example
    run (6.11), but quite close to that listed in the original experiments
 of   Plummer and Busenberg [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>],
     Table 4 (6.07 - 6.08) at PCO<sub>2</sub> around 0.96 (atm?). Our calculated
     total dissolved calcium - ca. 10.6 mmolal - is also in good agreement
 to   solubility data (ca. 11 mmol/kg soln of Ca+Sr) from this table at the
 lowermost   mole fraction of aragonite (0.83%). From this we can conclude
 that the GEM   model is now good enough to proceed, even though we cannot
 explain the difference   with the initial values of pH, total dissolved
Ca  and C&nbsp; given in the   PHREEQC2 example. <br>
         &nbsp; </p>
                  
<p>Next, we can&nbsp; test what happens if we include water vapor into the 
    gaseous phase (you may remember that H<sub>2</sub>O&nbsp; gas has been 
 excluded   when we constructed the first system definition). Open the "System" 
 window,   <tt>DComp</tt> page, and scroll down the <tt>DCvp</tt> list until 
 you find   the <tt>"g:O-2:H2O:&nbsp; "</tt> record key. Just to the left 
of it, change   '-' to '+' to switch the species on, then select <tt>"Phase"</tt> 
 page, and  press once or twice the <tt>"BCC"</tt> button on the "Single Thermodynamic
    System" dialog. If nothing happens and the plus against water vapor does
   not disappear, close the System window and calculate the new equilibrium
  state (surprisingly, by pressing the <tt>"IPM"</tt> button). Accept the
results    and go into the "EqDemo" window (<tt>EqGen</tt> page) to check
them. The   pH now is 6.054 and fCO<sub>2</sub> is 0.974 bar (0.9615 atm)
- even closer   to the experimental data in [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>]
    Table 4 than before. Clearly, the partial pressure of CO<sub>2</sub>
is   lowered by the water vapor partial pressure (0.026 bar) at fixed total
pressure   of 1 bar at 25 <sup>o</sup>C. <br>
         &nbsp; <br>
         &nbsp; <br>
         &nbsp; <br>
         &nbsp; </p>
                  
<h4> 3.1.6 Creating a new chemical system  definition</h4>
                     
<p><br>
         Next, you may wish to explore how the equilibrium state may change 
 with   temperature and/or pressure. This is very easy to do in GEM-Selektor 
 - it   just requires to create a new SysEq record using the old one as a 
template.   Following the aragonite-water example, let us try the last definition 
of  our chemical system at 1 bar, 76 <sup>o</sup>C. If you closed the GEMS 
work  session since the last exercise (Section 3.1.5) then start the program 
again,  open the "Default" profile, go to the "Single Thermodynamic System" 
dialog,  press the <tt>"Load..." </tt>button&nbsp; of the "Records" button 
group, select (mouse click) the system <tt>"Default:G:CaCO3_AQ:1:0:1:25:0:"</tt>
  from the appearing list, and press <tt>"Ok"</tt>. Using one of the available
  chemical system definitions as a template is always the easiest way to
create   a new, similar one. <br>
         &nbsp; </p>
                  
<p>Now, press the <tt>"Create"</tt> button. In the "SysEq: Please, enter
a new key" dialog, you will see the above record key in a disassembled form, 
    each part in a separate text line editor fields. In the temperature field 
    (second from the bottom), change 25 to 76 (to set temperature in 76 <sup>o</sup>C) 
    and press <tt>"Ok"</tt>. The following dialog will appear: <br>
         &nbsp; </p>
                  
<p><img src="file:///C:/GEMS2test/program/doc/html/syseqrem.png"
 nosave="" height="131" width="318" align="left">
          <br>
         &nbsp; </p>
                  
<p>As we want to change only temperature and leave the rest intact, don't
     press "Clear all" or "Remake" buttons, but carefully click on the "Bypass"
     button. This will retain everything unchanged in the program memory,
except     thermodynamic data for species (automatically recalculated to
76 C 1 bar)     and the SysEq record key. In a second delay, you will see
the "System"  window;  add <tt>"run at 76 C"</tt> to the <tt>tnote</tt> field,
if you like.  Close  the "System" window and press the "IPM" button to compute
a new equilibrium    state. Accept results (pH = 6.14, IS =&nbsp; 0.01) and
 examine pages of  the  EqDemo window. <br>
         &nbsp; </p>
                 The calculated total dissolved calcium - 3.6 mmolal - is 
in good agreement     with data from&nbsp; [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>]
     Table 4 at lowermost strontianite mole fractions (3.5-3.7 mol/kg soln).
   log<i>K </i><sub>sp</sub> = -8.829, calculated from log activities of
Ca<sup>+2</sup>      and CO<sub>3</sub><sup>-2</sup> ions (as described above),
is only 0.003     units different from that listed in their table (-8.826).
Calculated P(CO<sub>2</sub>)      = 0.67 bar is higher than reported (around
0.6 atm), most probably because      of neglection of the non-ideal mixing
of H<sub>2</sub>O and CO<sub>2 </sub>in     gaseous phase (see [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1994NOR/MUN%5D">1994NOR/MUN</a>]); 
    pH = 6.14 is, accordingly, somewhat lower (pH around 6.2 is given&nbsp; 
  in Table 4 of&nbsp; [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>]).
     <br>
 <br>
 <br>
 <br>
 
<p>Let us come back to our numerical example - the <a
 href="file:///C:/GEMS2test/program/doc/html/KSExamp/casrco3.html">aragonite-strontianite 
SSAS equilibrium system</a>.     Now, we will define a parent record to this 
system in order to investigate     later on, how aqueous and solid-solution 
speciation changes upon addition     of SrCO<sub>3</sub>&nbsp; to the bulk 
chemical composition. The parent  system   will be constructed from the aqueous 
solution, previously equilibrated  with   aragonite and CO<sub>2</sub> atmosphere 
(fCO<sub>2</sub> = 0.97 bar)  at 25  <sup>o</sup>C temperature and 1 bar total
pressure. Since, unlike fixed composition  phases, solubility of solid solutions
depends on the solid/water   (S/W) ratio,  this ratio must be also known.
We could not figure it out from  the PHREEQC2  Example 10 and hence will
take S/W the same as in the original  experiments&nbsp;  [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>] 
  - about 20 g/L.  The advantage is that the direct comparison of calculated 
  and measured concentrations  should then be possible. <br>
         &nbsp; </p>
                  
<p>From Main Dialog of GEMS, go into "Calculation of Equilibria" mode and
     open the "Default" system profile. Go into the "Single thermodynamic
system"     dialog and load the previously developed SysEq record <tt>"Default:G:CaCO3_AQ:1:0:1:25:0:"
     </tt>(with H<sub>2</sub>O vapor switched off and corrected solubility
 product   of aragonite)<font size="+1">. </font>Press the <tt>"IPM"</tt>
button to  re-calculate it, accept the results and open the "EqDemo" window,
<tt>EqIC</tt>  page. In the whole <tt>lgm_t</tt> vector, convert numbers
from logarithmic  to molal scale (using the <tt>F8</tt> key, calculator widget),
and write down the initial composition of aqueous solution - we will need
it soon: <br>
         &nbsp; <br>
         &nbsp;          
<table border="3" cellspacing="3" cellpadding="3">
          <tbody>
             <tr>
          <td><tt><font size="+1">ICnam</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
          <tt><font size="+1">molal</font></tt></td>
          </tr>
           <tr>
          <td>C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     0.05376</td>
          </tr>
           <tr>
          <td>Ca&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     0.01047</td>
          </tr>
           <tr>
          <td>H&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     0.02092</td>
          </tr>
           <tr>
          <td>O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     0.12845</td>
          </tr>
                                     
  </tbody>         
</table>
           </p>
                  
<p>Now, close the "EqDemo" window and press <tt>"Create"</tt> button, then
     enter a new record key <tt>"Default:G:CaSrCO3SS:0:0:1:25:0:"<font
 size="+1">,</font></tt>press <font size="-1">"Ok"</font> and then <tt>"Clear 
    all"</tt>. In the appearing "SysEq: Remake parameters" dialog, type in 
 <tt>"Parent   aragonite- strontianite SSAS system"</tt> as a name of the 
system and <tt>"Following   PHREEQC2 Example at 25 C"</tt> as a comment. Press
<tt>"Ok"</tt> when ready;   the "System" window, <tt>Compos</tt> page appears.
Find a pre-defined composition   "Aqua" in the <tt>CCvp</tt> list and, to
the right of it, type 993 to set   993 grams of H<sub>2</sub>O in the bulk
composition. Also, find the Mwat  (<tt>Masses[0,1]</tt>) cell in the first
row below the title (hint: click  on different cells and watch the bottom
status line of the window) and put  0.993 (kg) in there as a base for molality-into-moles
conversion. This is  necessary for specifying parts of the system bulk composition
in molality  units (i.e. moles per 1 kg H<sub>2</sub>O), and, in principle,
is used only  at the stage of system formulation; the Mwat quantity in not
necessarily the quantity of water-solvent <i>after</i>&nbsp; calculation
of equilibrium state. <br>
         &nbsp; </p>
                  
<p>Why did we add 993 grams of H<sub>2</sub>O to the system composition?
This is because we wanted to have 20 g/L S/W ratio (volume refers to the
suspension, i.e. water + aragonite). The density of aragonite is about 3
g/cm<sup>3</sup>, so the volume of 20 g of aragonite is about 7 cm<sup>3</sup>.
The remaining 993 cm<sup>3</sup> of water would then have a mass of about
993 g (neglecting the fact that density of water is slightly below 1 at 25
<sup>o</sup>C). More precise calculation, of course, is possible. <br>
         &nbsp; </p>
                  
<p>Now, go to the "<tt>IComp"</tt> page. Find the&nbsp; <tt>bi_</tt> column
     and, to the left of it, change <tt>'M'</tt> characters to <tt>'m'</tt>&nbsp;
     for&nbsp; C, Ca, H, O, and Sr, to set molality units for the respective
   cells of the <tt>bi_</tt> column. Then enter in these cells (<tt>bi_</tt>
   column) the numbers from the table above and the arbitrary trace amount
 0.5e-7  molal for strontium. This will add salt composition of water previously
 equilibrated   with aragonite, as well as some trace strontium, to total
bulk composition   of the system. <br>
         &nbsp; </p>
                  
<p>Next, switch to the <tt>"DComp"</tt> page and set 0.97 mol of CO<sub>2</sub>
     gas, 0.03 mol H<sub>2</sub>O gas, and 0.0001 mol of oxygen gas in the
 <tt>xd_</tt>    vector there. Scroll a little bit down the <tt>DCvp</tt>
list to find aragonite    and (below it) strontianite lines. To the left
of aragonite entry, change    <tt>'M'</tt> code (moles) to <tt>'g'</tt> (grams)
and put 20 in the respective   cell of the <tt>xd_</tt> vector, to add 20
g of CaCO<sub>3</sub> to the system.  In a similar way, add 7.5e-6 g of strontianite
stoichiometry (approximately    0.5e-7 mol). Then close the "System" window.
<br>
         &nbsp; </p>
                  
<p>Go to the&nbsp; "Single thermodynamic system" dialog and press the <tt>"BCC"</tt>
     button. On the appearing warning message, press <tt>"Switch off"</tt>
 and    then examine the <tt>IComp</tt> page on the "System" dialog window.
 The  <tt>B_</tt>  column (total bulk chemical composition of the system
in  moles)  should contain all zeros except C (1.223205 mol), Ca (0.210218
mol),  H (110.32052  mol), O (57.81709 mol), and Sr (1.0045e-7 mol). If something
 goes wrong, check setup of the bulk composition as described above. <br>
         &nbsp; </p>
                  
<p>What remains is to configure a set of phases to be taken into equilibria
     calculations. To do it, go to <tt>"Phase"</tt> page and make sure that
  only  the phases from the following list are selected (switched on with
pluses   in the first column): </p>
                  
<ul>
   <li> <tt><font size="+1">aq_gen</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     (generic aqueous electrolyte phase)</li>
   <li> <tt><font size="+1">gas_gen</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     (generic ideal gas mixture)</li>
   <li> <tt><font size="+1">Ca-stronti-sub</font></tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     (solid solution of Ca-strontianite)</li>
   <li> <tt><font size="+1">Sr-aragonit-sub</font></tt>&nbsp;&nbsp;&nbsp;&nbsp; 
    (solid solution of Sr-aragonite)</li>
   <li> <tt><font size="+1">Graphite</font></tt></li>
   <li> <tt><font size="+1">Portlandite</font></tt></li>
 
</ul>
           Make sure that single component phases Calcite, Strontianite and
 Sr-oxide     are switched off. Two (Ca,Sr)CO<sub>3</sub> solid solution
phases  are included    because of possible phase separation (miscibility
gap). These  phase definitions    are identical, except that in the first
one,&nbsp; the  strontianite end  member is declared "Major", and the aragonite
end member  "Junior" (you can  see it by clicking on phase name and pressing
<tt>F7</tt>,  the <tt>'M'</tt>  and <tt>'J'</tt> characters in a <tt>PhDCC</tt>
classifier  in "Phase" window).    In the second solid solution, the aragonite
end member  is declared "Major"    and the strontianite - "Junior". The difference
between  "Major" and "Junior"    is that, only at automatic (simplex) initial
approximation,  GEM-Selektor   takes the "Junior" phase component with an
activity coefficient  artificially   set to 1000. Thus, two (otherwise the
same) phases get initially  different   compositions. If total bulk composition
of the system falls into  the miscibility   gap, the compositions of two
solid solution phases will  become more and more  different on the IPM iterations
and will converge at  the solvus edges. Otherwise  (outside miscibility gap),
both phases either  will converge to the same mole  fractions of end members,
or one of them will be eliminated from the mass  balance. See textbooks (e.g.
[<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1994NOR/MUN%5D">1994NOR/MUN</a>], 
  p.141) to learn   more about immiscibility in non-ideal solid solutions. 
<br>
          &nbsp;          
<p>You probably remember that thermodynamic data used in GEM-Selektor kernel
     database produce slightly different solubility products of aragonite
than     that given by Plummer and Busenberg [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>]. 
Previously, for     the aragonite-water system, we made a -955 J/mol correction 
to <i>G <sup>0</sup></i><sub>298</sub>     value of aragonite to get log<i>K</i><sub>sp</sub> 
= -8.336 at 25 C, as   required.  Now, we have to go to "MTparm" window (<tt>"Thermodynamic 
Data   at T, P"</tt>  button on the&nbsp; "Single thermodynamic system" dialog) 
 and apply this correction again (in <tt>gEx_</tt> column), this time to&nbsp; 
  aragonite end members in both solid solution phases. With strontianite, 
however,  the required correction is much stronger. Click on its record key 
and press  <tt>F7</tt> to examine the DComp database record of strontianite. 
Robie and  Hemingway [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1995ROB/HEM%5D">1995ROB/HEM</a>] 
 provide  <i>G <sup>0</sup></i> = -1137600 J/mol with uncertainty 1500 J/mol. 
 Taking  data for Sr<sup>+2</sup> and CO<sub>3</sub><sup>-2</sup> ions from 
 SUPCRT92  (see "MTparm" window), one obtains log<i>K</i><sub>sp</sub> = -8.02&nbsp;
  by far too high from -9.271 from [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>]. 
 The difference    is -1.25 p<i>K</i> units, or&nbsp; -7137 J/mol! There might
 be a problem    with the number from [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1995ROB/HEM%5D">1995ROB/HEM</a>]; 
   anyway, we have to make a correction (-7137 to <tt>gEx_</tt> cells for 
both   strontianite end members) in order to stay consistent with the solid 
solution   model of Plummer and Busenberg. Do it and close the "MTparm" window. 
<br>
         &nbsp; </p>
                  
<p>Finally, press the <tt>"BCC"</tt> button one or two times to make sure
     that you have no more warnings, and press the <tt>"IPM" </tt>button
to   calculate  equilibrium state. Accept it and go to the "EqDemo" window
to  examine results.  Let's begin with the <tt>"EqGen"</tt> page. What you
see  is that pH = 6.054  and f(CO<sub>2</sub>) = 0.974 bar are the same as
in the Sr-free aragonite-water  system - which is expected because we added
only trace amount of total strontium  (1e-7 moles) to the system. Check the
total dissolved molalities (<tt>lgm_t</tt>)  on the <tt>EqIC</tt> page: Ca
10.467 mmolal (again the same as in the Sr-free  system) and Sr is 5.6e-8
molal, e.g. about a half of it is retained in the  solid solution phase (aragonite).
 <br>
         &nbsp; </p>
                  
<p>Let us check the phases we have at equilibrium (<tt>EqPh</tt> page). From 
    the numbers in <tt>Fa</tt> column we conclude that all three phases present 
    are stable;&nbsp; <tt>Ca-stronti-sub</tt> phase (strontianite with some 
  calcium)  has been eliminated. There are 20.0002 grams of the <tt>Sr-aragonit-sub</tt>
     phase - which means that the system was formulated correctly and can
indeed     be used as a parent to simulate the process of changing Sr/Ca
ratios in   solid phase composition. <br>
         &nbsp; </p>
                  
<p>Now, let us examine the speciation (<tt>EqDC</tt> page). In the <tt>x</tt>
     vector, we see that aqueous Sr is present mainly as Sr<sup>+2</sup>
ion    and Sr bicarbonate complex - pretty similar to calcium. Scroll down
to see   the carbonate solid solution end members. Strontianite end member
is present    only in trace mole fraction 2.3e-7 (you can see it in the <tt>Wxx</tt> 
 column   if you scroll down the whole EqDemo window). Activity coefficient 
 of aragonite   (<tt>gamma</tt> column) is 1, but the activity coefficient 
 of strontianite   end member is 189.46. Clearly, this is a non-ideal solid 
 solution model.  Let us see how it is defined. <br>
         &nbsp; </p>
                  
<p>Go to the EqPh page, click on <tt>Sr-aragonit-sub</tt> phase name and
press <tt>F7;</tt> the "Phase" window will appear, it has three pages. <tt>Page
     1</tt> just shows that the solid solution contains two end members,
aragonite      and strontianite, and the latter is declared "Junior". Select
<tt>Page   2</tt>.  You will see there a DcEq text field with the following
<a href="file:///C:/GEMS2test/program/doc/html/gmscript.html">math script</a>: 
</p>
                  
<blockquote><tt>$ Asymmetric model of aragonite-strontianite solution</tt>
       <br>
           <tt>$ for 25 C: A0 = 8490 J/mol A1 = -4510 J/mol</tt> <br>
           <tt>$ for 75 C: A0 = 7710 J/mol A1 = -3360 J/mol</tt> <br>
           <tt>ln_gam[0] =: ( Wx[1]^2 *(8490-4510*(4*Wx[1]-3)))/RT_; \@</tt>
    <br>
           <tt>ln_gam[1] =: ( Wx[0]^2 *(8490-4510*(4*Wx[1]-1)))/RT_; \@</tt>
    <br>
           <tt>$ end</tt></blockquote>
           This math script calculates activity coefficients of the Guggenheim 
  asymmetric   model for both end members at each iteration of the IPM minimization 
  algorithm   (<tt>Wx</tt> is mole fraction, <tt>ln_gam</tt> is natural logarithm 
  of activity  coefficient, <tt>RT_</tt> = 2479 for 25 C; all three variables
   are defined  by the IPM algorithm before this script is automatically
executed    in each  iteration; <tt>\@</tt> marks end of the group of equations
for  one  component).  That's it! In a similar way, you can create your own
non-ideal    phase model  and keep it in the database together with other
<a href="file:///C:/GEMS2test/program/doc/html/gm_phase.html">phase   definitions</a>. 
<br>
          &nbsp;          
<p><a name="SIDEBAR_1"></a>A little sidebar: before proceeding with setting
     up a process simulator, let's check what happens if we take 10 g of
CaCO<sub>3</sub>      and 10 g of SrCO<sub>3</sub> in the bulk composition
of the system. According      to [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>], 
this would     bring us inside&nbsp; the miscibility gap. Close the EqDemo 
window and  create  a new system, with SysEq record key <tt>"Default:G:CaSrCO3SS:1:0:1:25:0:"<font
 size="+1">,</font></tt>press <tt>"Ok"</tt> and then <tt>"Bypass"</tt>. In 
    the&nbsp; the "System" window, go to <tt>DComp</tt> page, and in the <tt>xd_</tt>
    column, change the previous numbers of grams of aragonite and calcite
to   10 and 10. Add words <tt>"(miscibility gap)"</tt> to <tt>tnote</tt> comment,
   close "System" window and press <tt>"IPM"</tt> button to calculate the
new   equilibrium state. Accept the results and open "EqDemo" window to examine
   them. <br>
         &nbsp; </p>
                  
<p>On the <tt>EqPh</tt> page, you will see that four phases are now stable;
     <tt>Ca-stronti-sub</tt> phase (strontianite with some calcium) now appears 
    in the amount of 10.888 g (there is also 9.022 g of <tt>Sr-aragonit-sub</tt> 
    phase). However, as seen on the <tt>EqDC</tt> page, the composition of 
 two   carbonate solid solutions is now completely different: <br>
         &nbsp; <br>
         &nbsp;          
<table border="3" cellspacing="3" cellpadding="3" width="68%">
          <tbody>
             <tr>
          <td>Phase</td>
           <td>End-member&nbsp;</td>
           <td>Type</td>
           <td>Mole <br>
         fraction</td>
           <td>Activity&nbsp; <br>
         coefficient</td>
          </tr>
           <tr>
          <td><tt>Ca-stronti-sub</tt></td>
           <td><tt>aragonite&nbsp;</tt></td>
           <td><tt>J</tt></td>
           <td><tt>0.1426</tt></td>
           <td><tt>6.9807</tt></td>
          </tr>
           <tr>
          <td><tt>&nbsp;</tt></td>
           <td><tt>strontianite&nbsp;</tt></td>
           <td><tt>M</tt></td>
           <td><tt>0.8574</tt></td>
           <td><tt>0.9800</tt></td>
          </tr>
           <tr>
          <td><tt>Sr-aragonit-sub</tt></td>
           <td><tt>aragonite&nbsp;</tt></td>
           <td><tt>M</tt></td>
           <td><tt>0.9952</tt></td>
           <td><tt>1.0002</tt></td>
          </tr>
           <tr>
          <td><tt>&nbsp;</tt></td>
           <td><tt>strontianite&nbsp;</tt></td>
           <td><tt>J</tt></td>
           <td><tt>0.0048</tt></td>
           <td><tt>173.96</tt></td>
          </tr>
                                     
  </tbody>         
</table>
           <br>
         &nbsp; </p>
                  
<p>As expected, we have now a mixture of two phases with the "most stable"
     compositions on the edges of the miscibility gap, with quite small fraction
     of SrCO<sub>3</sub> in Sr-aragonite phase. Plummer and Busenberg [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>] 
report that at 25     <sup>o</sup>C, the most stable aragonites should contain 
0.58 mol% of SrCO<sub>3</sub>    (0.48% in our calculation) and the most stable
strontianites - 82.8% SrCO<sub>3</sub>    (85.7% in our calculation). We
will now proceed to the process simulation    with this realistic SSAS model.
Just close the "Single thermodynamic system"    dialog to go back to the
"Computation of Equilibrium Models" dialog. <br>
         <br>
 </p>
 
<p>        &nbsp;                 </p>
   
<h4>3.2.1 Setting up a Process Simulator</h4>
                     
<p><br>
         If you closed GEMS work session, start the program again, go into
 the   "Calculation  of Equilibria" mode and open the "Default" system profile.
  <br>
         &nbsp; </p>
                  
<p>From the "Computation of Equilibrium Models" dialog, click on a <tt>"Process
     Simulation (Process)"</tt> button. This will bring you a (still empty)
  "Process"  module window. Select <tt>"Create"</tt> from the <tt>"Record"</tt>
  menu to  create your first <a
 href="file:///C:/GEMS2test/program/doc/html/gm_proces.html">Process definition</a>
  record.&nbsp;  You will see a dialog window entitled "SysEq: Please, select
  a parent system  for a new Process" with a list of <a
 href="file:///C:/GEMS2test/program/doc/html/gm_syseq.html">SysEq records</a> 
 available in the "Default" profile.&nbsp;  Click on the <tt>"Default:G:CaSrCO3SS:0:0:1:25:0:"</tt>&nbsp; 
  record key  (to mark/select it) and press <font size="-1">"Ok"</font> to 
proceed.  Now,  a small "Process: Please, enter a new key" dialog appears 
with the last two  lines containing asterisks <tt>'*'</tt> in two fields added
to the above-mentioned  record key. Replace <tt>'*' </tt>with&nbsp; <tt>'S'</tt>
in the last field,  to indicate that the process will change bulk composition
 independently of calculated equilibrium parameters. In a field above (previous-to-last
  one), type <tt>"CaSr_r20gL"</tt> as a process simulator identifier (because
  several processes can be defined using the same parent SysEq record). Press
  <tt>"Ok"</tt>  whe finished, then <tt>"Clear all"</tt> on the appearing
"Reorganization  of data fields" dialog. <br>
         &nbsp; </p>
                  
<p>This brings you into a "Process: Remake parameters" configuration dialog
     - quite important in case of the Process definition. The first two lines,
     as usual, should contain the full name of the record and optional comments
     to it; type in something like that: <br>
         &nbsp; </p>
                  
<blockquote><tt>"Solubility of (Ca,Sr)CO3 as f(X_Sr) at 20 g/L"</tt> <br>
           <tt>"Expanding Example 10 from PHREEQC2 users guide"</tt></blockquote>
                     
<p><br>
         Below, there is a line of switches which control operation and data
  structure   of the Process module; click on each to read tool tips. It's
 the right moment   to think again what the process simulator must do. <br>
         &nbsp; </p>
                  
<p>To see the effect of bulk solid composition on equilibrium solubility
of Ca and Sr and mole fraction of (Ca,Sr)CO<sub>3</sub> phase(s) at ca. 20
g/L S/W ratio, we need to "mix"&nbsp; <i>nu</i>&nbsp;&nbsp; grams of CaCO<sub>3</sub> 
    with (20 - <i>nu </i>) grams of SrCO<sub>3</sub>, incrementing <i>nu</i>&nbsp;
     from, say, 0 to 20 with a 1 g step which gives 21 points in total. The
  rest  of the system definitions can be left the same as in the parent system, 
   because  solubility of mixed carbonate will not exceed a few millimolal, 
  e.g. significant  change of S/W ratio is not likely to occur. The Process 
  module generates new SysEq records by duplicating ("cloning") the parent 
 system, and then applies necessary changes to these new records. <br>
         &nbsp; </p>
                  
<p>In our (pretty simple) case, it is sufficient to switch off (i.e., put
     minus instead of plus) <tt>PePsts[0,1]</tt> because temperature and
pressure      will be kept fixed, but make sure that <tt>PePsts[0,2]</tt>
is on since    bulk composition will be changed, and <tt>PePsts[0,4] </tt>is
on - to save    the newly created SysEq records to database. <tt>PePsts[0,10]</tt>&nbsp;
  must be on because we will provide a math script for modifying bulk compositions.
     Put also a minus in <tt>PePvv[0,10]</tt> to always use the automatic
Simplex     initial approximation in <a
 href="file:///C:/GEMS2test/program/doc/html/gems_ipm.html">GEM IPM</a> calculations. 
    Then proceed to the leftmost counter <tt>Ntxi</tt> and set there 21 (points 
    to be generated). You may also put&nbsp; 1 into <tt>PePdim[0,4]</tt> to
  set one bibliographic reference. Check the switches once more and press 
<tt>"Ok"</tt>.    <br>
         &nbsp; </p>
                  
<p>Now, you see <tt>Page 1</tt> of the "Process" window with the record key 
    and the name of the process simulator, but with several empty fields, 
including    a multi-line text editor field <tt>P_expr</tt>.&nbsp; Many variants 
of the   process simulation can be set up using one or more of three-number 
column   "iterators"&nbsp; <tt>iTm, iNv, iP, iTC, iV, iTau, ipXi, iNu, ipH, 
ipe</tt>.   Each of those has the following structure: <br>
         &nbsp; </p>
                  
<dl>
  <dd> <tt>&lt;iterator_name&gt;[0]&nbsp; start (initial) value</tt></dd>
  <dd> <tt>&lt;iterator_name&gt;[1]&nbsp; limiting value</tt></dd>
  <dd> <tt>&lt;iterator_name&gt;[2]&nbsp; increment (0 - keep at start value)</tt></dd>
</dl>
                     
<p><br>
         The Process module has also one work cell for each iterator, named 
 <tt>cTm</tt>    (for <tt>iTm</tt> iterator), <tt>cNv</tt> (for <tt>iNv</tt>) 
 and so on;  you can see all these work cells on <tt>Page 2</tt> of the "Process" 
 window.  Contents of the work cells can be changed on every iteration of 
the Process  Simulator, either automatically using the start and increment 
values from  the respective iterator, or by the user-defined math script (see
below). The first five iterators&nbsp; <tt>iTm, iNv, iP, iTC, </tt>and<tt> 
iV </tt>are  used&nbsp; by the program automatically to increment respectively 
the <tt>cTm,  cNv, cP, cTC, </tt>and<tt> cV </tt>work cells and from these 
generate the  last five fields of newly-created&nbsp; <a
 href="file:///C:/GEMS2test/program/doc/html/gdb_rkey.html#dbm_SysEq">SysEq 
 record keys</a>.&nbsp; Other iterators   are not incremented automatically 
and may be used only in the Process math   scripts expressions to set work 
variables, such as <tt>cNu</tt>. The full   list of iterators, work cells 
and other data objects related to the Process   Simulators, which can be used
in math scripts, is available in the <a
 href="file:///C:/GEMS2test/program/doc/html/g_useref.html">user's reference</a> 
and in the <a
 href="file:///C:/GEMS2test/program/doc/html/gm_proces.html">Process module 
documentation</a> files. <br>
         &nbsp; </p>
                  
<p>In the&nbsp; <tt>iTm</tt>&nbsp; iterator, it makes sense to put an increment
     larger than 1 (at best, 5 or 10) if the process simulation will change
  the  total bulk composition of the system. The SysEq records generated
by   the Process Simulator will then be numbered like 1000, 1010, 1020, ...
-  this leaves you a possibility of producing more points in the most interesting 
    parts of the batch sequence later on (e.g., obtain better resolution near
    the redox barrier). Please, keep in mind that the process step counter 
 <tt>Ntxi</tt>   has a priority over iterators - the simulation is finished 
 when <tt>Ntxi</tt>   points are computed, regardless of which limiting values 
 in the iterators   are not yet reached. <br>
         &nbsp; </p>
                  
<p>Now, let us come back to setting the iterator values. First of all, we 
    need to set constant pressure (1 bar) and temperature (25 <sup>o</sup>C).
     To do it, select the&nbsp; <tt>iP</tt>&nbsp; column and put 1 into the
  first  cell (start value), 1 into second one (end value), and 0 into third
  one (increment).  Likewise, set the <tt>iTC</tt> column for fixed 25 <sup>o</sup>C. 
   In the <tt>iTm</tt> column, set 1000 in the first, 1200 in second, and 
10   in the third cell; this will generate SysEq records with 1000, 1010, 
1020,   ..., 1190, 1200 CSD (<u>c</u>hemical <u>s</u>ystem <u>d</u>efinition) 
variant   numbers in the fourth field of the <a
 href="file:///C:/GEMS2test/program/doc/html/gdb_rkey.html#dbm_SysEq">SysEq
    record key</a>. Finally, set 0 in the first, 20 in&nbsp; second, and
1  in  third cells of the<tt> iNu</tt> column, to be used as an iterator
for  a master  variable&nbsp; <tt>cNu</tt>&nbsp; in the <a
 href="file:///C:/GEMS2test/program/doc/html/gm_proces.html#P_expr">Process 
  math script</a>. <br>
         &nbsp; </p>
                  
<p>This knowledge must be sufficient for us to write a necessary <a
 href="file:///C:/GEMS2test/program/doc/html/gmscript.html">math script</a>. 
It has to assign current <tt>cNu</tt>     value to number of grams of strontianite 
( <tt>xd_[{strontianite}]</tt>   )  and <tt>20 - cNu</tt> to number of grams 
of aragonite ( <tt>xd_[{aragonite}]</tt>)     - see how we specified 10 grams 
of each in our <a
 href="file:///C:/GEMS2test/program/doc/html/gemstart.html#SIDEBAR_1">previous</a>
     <br>
         <tt>"Default:G:CaSrCO3SS:1:0:1:25:0:"</tt> system definition! The
 math   script  must look like this: <br>
         &nbsp; </p>
                  
<blockquote><tt>$ Changing Sr/Ca ratio in solid on iteration</tt> <br>
           <tt>cNu =: iNu[0] + J * iNu[2];</tt> <br>
           <tt>xd_[\J{aragonite}] =: 20 - cNu;</tt> <br>
           <tt>xd_[{strontianite}] =: cNu;</tt> <br>
           <tt>$ End</tt></blockquote>
                     
<p><br>
         Enter it into the <tt>P_expr </tt>field on <tt>Page 1</tt> of the
 "Process"    window (you can also drag mouse to select the text in the Help
 browser window,   then press <tt>Ctrl-c</tt>, click on the <tt>P_expr </tt>field 
 and press  <tt>Ctrl-v</tt>). In this script: <br>
         &nbsp; </p>
                  
<blockquote><tt>'$'</tt>&nbsp; character starts a comment line; <br>
           <tt>J</tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; is an internally changed
  Process    iteration index; <br>
         Expression&nbsp; <tt>cNu =: iNu[0] + J * iNu[2];</tt> <br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     increments<tt> cNu</tt> from 0 to 20 by 1; <br>
         Expression&nbsp; <tt>xd_[\J{aragonite}] =: 20 - cNu;</tt> <br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     assigns 20, 19, ..., 1, 0 grams to the <tt>xd_</tt> vector cell <br>
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     for the first occurrence of <tt>aragonite</tt> in the species list.</blockquote>
                     
<p><br>
         The <tt>"\J"</tt> switch tells the program to look for the index 
of&nbsp;     <tt>aragonite</tt> in the Profile species name list (such switches 
will   be  obsolete in the next version of GEMS). Before simulations, the 
DC index   is  determined and substituted against the species name (e.g., 
<tt>xd_[238]</tt>).     As some species can be added or removed to/from the 
profile later on, writing    indices directly into <a
 href="file:///C:/GEMS2test/program/doc/html/gmscript.html">math scripts</a>
 would create    incompatibility problems; that is why name preprocessing
has been implemented    in GEM-Selektor.&nbsp; Now the Process Simulator
is ready to run. <br>
         &nbsp; <br>
         &nbsp; </p>
                  
<h4> <a name="3_2_2_run_process"></a>3.2.2 Running the Process batch IPM calculations</h4>
           After editing of the process definition fields is finished, press 
 the&nbsp;<tt>    "Calculate"</tt> button or <tt>"Record" "Calculate"</tt> 
 menu commands to  start simulation. You will be asked to save the Process 
 record to database    (to be able to recover it if something goes wrong with
 calculations).&nbsp;    If the Process math script contains syntax errors,
 you may be asked to fix  them before the program can proceed. In our numerical
 example, you will   get  warnings that the program finds more than one "aragonite"
 and "strontianite"    - a consequence of having two mixed carbonate phases
 with the same end member   names (two copies of solid solution phase definition
 are needed to simulate   phase separation). Just take the first ones and
proceed with calculations.   <br>
          &nbsp;          
<p>During calculations, the "IPM Minimization Progress"&nbsp; dialog is normally 
    visible, showing the currently processed SysEq record key. Calculations 
  may  take some time if the system is large or the process simulator generates
    hundreds of points (depending on computer performance). When all equilibria
    are computed, you will see a message "Process calculation finished OK"
 in   the status line of the "Process: " window. Press "<tt>Accept</tt>"
button,     then close the "Process" window (with save), and proceed with
analyzing   the  results. <br>
         &nbsp; </p>
                  
<p>The simplest (but less convenient)&nbsp; way is to examine each generated
     equilibrium state (stored in a SysEq record) separately, as a single
system,     as described in <a
 href="file:///C:/GEMS2test/program/doc/html/gemstart.html#3_1_4_exam_results">Section 
3.1.4</a>. Go into    the&nbsp; "Single thermodynamic system" dialog and press
the "Load..." button.   In the appearing list, you should see many entries
for the "<tt>CaSrCO3SS</tt>"    system, numbered 1000, 1010, 1020 and so
on - generated by our process simulator.   Click on (select) any of them
- for instance, 1050 - and press "Ok", then   open the "EqDemo" window.&nbsp; 
There you will see that two carbonate solid   solutions of different compositions 
are present, with mole fractions of end  members just on the solvus edges, 
so the system looks pretty much the same  as&nbsp; <tt>"Default:G:CaSrCO3SS:1:0:1:25:0:" 
</tt>(<a
 href="file:///C:/GEMS2test/program/doc/html/gemstart.html#SIDEBAR_1">end 
of Section 3.2</a>). <br>
         &nbsp; </p>
                  
<p>Within the miscibility gap, all equilibria (numbered 1010 to 1080) will
     have the same pH and solubility values, only masses of two mixed phases
   will differ. Clearly, 4-6 points in this composition region would be enough;
   there are only 1 and 2 points left for the one-phase regions, - quite
insufficient      to produce complete diagrams. Luckily, in GEM-Selektor
it's easy enough    to improve the math script in the Process simulator definition.
Let us try   - close the "EqDemo" window and the "Single Thermodynamic System"
dialog,    and go back to the "Process" window. Load there our previously
created Process    definition record <tt>"Default:G:CaSrCO3SS:0:0:1:25:0:CaSr_r20gL:S:<font
 size="+1">"</font></tt><font size="+1">.</font> <br>
         &nbsp; </p>
                  
<p>There are many ways of modifying the math script for "non-linear" change
     of <tt>cNu</tt> variable - you can try yourself. Now, let us simply
provide      positions of 21 simulation points, defined in terms of mole
fraction of   strontianite end-member. The math script must, accordingly,
convert mole  fractions into grams (keeping total 20 g of the solid) and
then assign them  to <tt>xd_</tt> vector cells as before. <br>
         &nbsp; </p>
                  
<p>To implement these changes,&nbsp; select <tt>"Record" "Remake"</tt> menu 
    item on the "Process" module window, and press <tt>"Remake"</tt> button 
  on  the "Reorganization of Data Fields" dialog. This will open the "Process:
    Remake Parameters" dialog; find the<tt> PePvv[0,9]</tt> flag and switch
  it  on (put  <tt>'+'</tt>) to allocate a&nbsp; <tt>modC&nbsp;</tt> work
array.    Then find the&nbsp; <tt>PeDim1[0,1]</tt> count cell and enter 1
there -  to  tell the program that the&nbsp; <tt>modC</tt>&nbsp; array will
have one  column  (and 21 lines, as indicated in the&nbsp; <tt>Ntxi</tt>
cell).&nbsp;  Press  <tt>"Ok"</tt> when ready and <tt>"Cancel"</tt> on the
next "GtDemo:  Set template"  dialog. We are now back to the "Process" window;
the newly-created   <tt>modC</tt>&nbsp;   vector can be seen to the right
of the math script  field <tt>P_expr</tt>.   Now, you can simply enter mole
fractions of strontianite   in solid composition   into <tt>modC</tt>&nbsp;
like this (in mol %): 0;  0.1; 0.2; 0.3; 0.4; 0.5;   3; 10; 20; 40; 60; 80;
84; 85; 87; 90; 93; 97;  98; 99.9; 100.&nbsp; Then  modify math script in
the&nbsp; <tt>P_expr</tt>&nbsp;   field as follows (check  for molar masses
of aragonite and strontianite in  their DComp records, <tt>M0d</tt>   field).
<br>
         &nbsp; </p>
                  
<blockquote><tt>$ Changing Sr/Ca ratio in solid on iteration</tt> <br>
           <tt>cNu =: modC[J]/100; cXi =: 1 - cNu;</tt> <br>
           <tt>$ Mole fraction/mass factor, normalized to 20 g</tt> <br>
           <tt>cpXi =: 20 / ( 147.629 * cNu + 100.089 * cXi );</tt> <br>
           <tt>xd_[\J{aragonite}] =: cpXi * cXi * 100.089;</tt> <br>
           <tt>xd_[{strontianite}] =: cpXi * cNu * 147.629;</tt> <br>
           <tt>$ End</tt></blockquote>
                     
<p><br>
         This math script is more complex because of a conversions between
 mole   fractions  and moles of CaCO<sub>3</sub> and SrCO<sub>3</sub>, and
 a need   to maintain  20 grams of total solid per liter of aqueous suspension.
 <br>
         &nbsp; </p>
                 Calculate the process simulation again. What remains to
do is to plot some relevant results. Don't do it by hand - the GtDemo module 
is at your disposal.  <br>
         &nbsp; <br>
 
<p>In the appearing "GtDemo: Remake parameters" dialog, first type in <tt>GDname</tt>
     and <tt>GDcom</tt> fields as follows: <br>
         &nbsp; </p>
                  
<p><tt>Solubility of Ca and Sr at equilibrium with (Ca,Sr)CO3 SS</tt> <br>
         <tt>as function of bulk solid X(Sr) at S/W = 20 g/L</tt> <br>
         &nbsp; </p>
                  
<p>The idea is to plot total dissolved calcium and strontium (molal) as function 
    of total mole fraction of Sr in solid phases (i.e. in binary system). 
As   experimental data in [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>] 
    does not discriminate between Ca and Sr, we will also plot a Ca+Sr line 
  and will compare it with some experimental points. So, in total we have 
3  plots and need 3 columns in the <tt>y0</tt> table and, say, 7 experimental 
  points and 1 column in the <tt>yE</tt> table. To set this up, find the <tt>gDimXY[0,1]</tt>
    cell and enter 3 there, then enter 7 and 1 into <tt>gDimEf[0,0]</tt>
and    <tt>gDimEf[0,1]</tt>,  respectively, and turn on (<tt>'+'</tt>) the
<tt>GDps[0,0]</tt>    flag. Press  <tt>"Ok"</tt> when finished. <br>
         &nbsp; </p>
                  
<p>A small "Set template" dialog will appear, just press <tt>"Ok"</tt> for 
    now. You will see a list of SysEq record keys with a title " Marking record
    keys for data extraction". With left mouse clicks, select all <tt>CaSrCO3SS</tt>&nbsp;
    record keys numbered from <tt>1000</tt> to <tt>1200</tt> (as they were
 set  up in the Process definition). Selected lines in the list are indicated
   by  dark background color. Press <tt>"Ok"</tt> when ready. You will see
 the  "GtDemo"  window (<tt>Page 1</tt>) with empty single- and multi-line
 editor  fields.  The largest one is called <tt>gExpr</tt>, it must contain
 a <tt>GtDemo</tt>   <a
 href="file:///C:/GEMS2test/program/doc/html/gmscript.html">math script</a>, 
written, in principle, in a similar   way as that in the <a
 href="file:///C:/GEMS2test/program/doc/html/gm_proces.html">Process simulator</a>
 definition.   <tt>gX_Nam</tt> and <tt>gY_Nam</tt> fields may contain names
 of abscissa  and ordinate axis, respectively (in our case <tt>"X_Sr"</tt>&nbsp; 
 and <tt>"log_m"</tt>).   The <tt>gLnam</tt> list contains identifiers for 
 the plot lines (columns  in the <tt>y0</tt> array), in case of our example, 
 enter <tt>"Ca_aq", "Sr_aq"</tt>   and <tt>"Ca+Sr"</tt>; likewise, the <tt>gLnamE</tt> 
 object identifies (plots   of) the empirical data that the user has entered 
 into columns of the optional   <tt>yE</tt> array (<tt>"Ca+Sr_E"</tt>). <br>
         &nbsp; </p>
                  
<p>Now, it's time to write the math script; in GtDemo definition, it must
     contain assignments such as <tt>x0[jR] =: ...... ;&nbsp; y0[jR][0] =:
 ....;    y0[jR][1] =: ...;&nbsp; ......</tt>&nbsp; Such operators will put
 sampled    data into lines of the <tt>x0</tt> and <tt>y0</tt> arrays. In
most cases,    it is sufficient to describe only how one record should be
sampled using   the <tt>jR</tt> index variable which is automatically changed
from 0 to <tt>gDimXY[0,0]   </tt>(total number of sampled records) upon GtDemo
 module execution. On the right side of assignment operators, you can use
any (indexed) <a
 href="file:///C:/GEMS2test/program/doc/html/g_useref.html">data object labels</a>
which refer to meaningful numerical  data existing at present in GEM-Selektor
program memory. These labels are  seen on any module page screen forms (e.g.,
"EqDemo") or window status lines.   <br>
         &nbsp; </p>
                  
<p>For our example (Ca-Sr carbonate SSAS system), the following script will 
    do the job: <br>
         &nbsp; </p>
                  
<blockquote><tt>$ Determine Sr mole fraction in solid</tt> <br>
           <tt>x0[jR] =: ( b[\i{Sr}] - bXa[0][{Sr}] ) /</tt> <br>
           <tt>&nbsp; ( b[{Sr}] - bXa[0][{Sr}] + b[{Ca}] - bXa[0][{Ca}] );</tt> 
     <br>
           <tt>$ Collect total dissolved Ca and Sr in log molal</tt> <br>
           <tt>y0[jR][0] =: lgm_t[{Ca}];</tt> <br>
           <tt>y0[jR][1] =: lgm_t[{Sr}];</tt> <br>
           <tt>$ Calculate log of sum of dissolved Ca and Sr</tt> <br>
           <tt>y0[jR][2] =: lg( 10^lgm_t[{Ca}] + 10^lgm_t[{Sr}] );</tt> <br>
           <tt>$ End</tt></blockquote>
                     
<p><br>
         You can see the contents of data objects&nbsp; <tt>b&nbsp;</tt>
and&nbsp;     <tt>lgm_t</tt> in the "EqDemo" window, page <tt>EqIC</tt> and
the bXa&nbsp;     data object - in the "Multi" window, page <tt>Phas D</tt>.
Both are accessible     from the "Single Thermodynamic System" dialog, buttons
<tt>"Dual solution..."</tt>     and <tt>"Details for experts"</tt>, respectively.
Every time when a new   SysEq  record is loaded by the GtDemo module, the
script will be executed,   the <tt>jR</tt>  index automatically incremented,
and the next record loaded   from the database.  Enter the script (or copy
it using clipboard) into <tt>gExpr</tt>    editor field on <tt>Page 1</tt>
of the "GtDemo" window and press the <tt>"Calculate"</tt>     icon or <tt>"Record"
"Calculate"</tt> menu commands (save the GtDemo record     to database upon
warning). <br>
         &nbsp; </p>
                  
<p>If there were no syntax errors in the math script, the program will silently 
    spend some seconds for loading SysEq records one-by-one and calculating 
  the  data. Finally, the "GtDemo" window title will show a message "Calculation
     finished OK". Now, we can examine and plot the results; to do it, select
    <tt>Page  2</tt> of rhe "GtDemo" window. There you will see <tt>x0</tt>
  and  <tt>y0</tt>  arrays filled with sampled numbers, as well as <tt>xE
</tt>and    <tt>yE</tt>  columns still containing zeros. From the <tt>"Record"</tt>
  menu,  the <tt>"Print"</tt>  item exports data to ASCII print files, and
 the <tt>"Plot"</tt>  item opens  the Graph Dialog window where <tt>y0</tt>
 and <tt>yE</tt> columns  are plotted  as lines (or scattered symbols, or
both) against the <tt>x0 (xE)</tt> abscissa.  <br>
         &nbsp; </p>
                  
<p>Select the <tt>"Record" "Plot"</tt> menu commands. You will be prompted
     to save the GtDemo record to database (it is always wise to do it).&nbsp;
     A graph window entitled as the "GDname" line appears. You can see what
  each  line means in the "Legend" on the right side. A The <tt>"Fragment"
 </tt>button   will display an enlarged fragment of the graph. A <tt>"Print..."</tt>
 button   sends the plot window contents to standard printing device (in
this  version,   may still be under construction). Line thickness, color
and symbols  can be customized in the Legend Dialog which appears on pressing
the <tt>"Customize..."</tt>      button on the graph. There you can set up
scales for abscissa and ordinates,      select axis type (the number of grid
lines), define size and position  of   zoomed fragment, and set symbol shape,
size and color, as well as line  thickness   and color, for each ordinate.
The <tt>"Background"</tt> button  lets you specify  a background color for
the graph (not saved with other contents of GtDemo  record in this version).
<br>
         &nbsp; </p>
                  
<p>If you have entered some experimental data into <tt>xE</tt> and <tt>yE</tt>
     arrays, their symbols and colors can be customized separately on the
Legend     dialog. For capturing a ready GtDemo graph window into <tt>*.jpg</tt>,
  <tt>*.png</tt>   or other graphic file formats, we recommend using a <tt>ksnapshot</tt>
  utility  program (a Linux KDE application) or Win32 <tt>Alt-PrtSc</tt>
key   combination  to send the picture to clipboard, from where it can be
inserted   into an image  editor (e.g., Microsoft(R) Photo Editor). <br>
         &nbsp; <br>
         &nbsp; <br>
         &nbsp; </p>
                  
<h4> <a name="3_2_5_export_results"></a>3.2.5 Exporting sampled results</h4>
                     
<p><br>
         To export data sampled by a GtDemo definition, open the "GtDemo" 
window,     load a record of interest, and select <tt>"Record" "Print"</tt> 
commands    from the menu. You will have to answer questions such as which 
format (tabular     or plain text) to use, and whether to print math script 
together with the    data. Then a standard "File selection" dialog appears 
where you can enter    the file name and choose the directory path to save 
the file. This ASCII   file can then be edited using any standard text editor 
and imported into  Microsoft(R) Excel or other commercial presentation programs. 
We are going  to provide output filters for exporting data into some important 
formats  in the future versions of GEM-Selektor. <br>
         &nbsp; </p>
                  
<p>Let us return to our numerical example - (Ca,Sr)CO<sub>3</sub> SSAS system, 
    - and examine the plot of aqueous solubility data in more details. Please, 
    open the "GtDemo" window, load the previously created record keyed "<tt>Default:SysEq:GT:0:CaSrCO3SS_aq:"</tt>, 
    and plot it (<tt>"Record" "Plot"</tt> menu commands). We see on the plot 
   that Sr_aq steeply increases from less than 1e-7 to about 1e-3 molal at 
 1e-6  &lt; <i>X</i> (Sr) &lt; 0.005 and then Sr_aq and Ca_aq remain constant 
 along  the miscibility gap where compositions of both solid solution phases 
 are fixed at the spinodal mole fractions up to <i>X</i> (Sr) = 0.86. At higher
  mole fractions of Sr in the solid, Sr_aq increases up to the solubility 
of  pure strontianite (4.5 mmolal) while Ca_aq goes below 1e-6 molal. <br>
         &nbsp; </p>
                  
<p>Let us see how the calculated total dissolved Ca+Sr fit with the experimental
     data of Plummer and Busenberg [<a
 href="file:///C:/GEMS2test/program/doc/html/g_litref.html#%5B1987PLU/BUS%5D">1987PLU/BUS</a>]. 
 To save time, enter into <tt>xE</tt> and <tt>yE</tt> columns on <tt>Page 
2</tt> of the "GtDemo" window only seven points from their Table 4 for 25 
<sup>o</sup>C  at nearly one bar p(CO<sub>2</sub>): <br>
         &nbsp; <br>
         &nbsp;          
<table border="3" cellspacing="3" cellpadding="3">
          <tbody>
             <tr>
          <td><tt>X(Sr),xE</tt></td>
           <td><tt>0.0083</tt></td>
           <td><tt>0.114</tt></td>
           <td><tt>0.411</tt></td>
           <td><tt>0.565</tt></td>
           <td><tt>0.859</tt></td>
           <td><tt>0.925</tt></td>
           <td><tt>0.998</tt></td>
          </tr>
           <tr>
          <td><tt>Solubility</tt></td>
           <td><tt>10.81</tt></td>
           <td><tt>11.58</tt></td>
           <td><tt>10.57</tt></td>
           <td><tt>8.72</tt></td>
           <td><tt>5.56</tt></td>
           <td><tt>5.13</tt></td>
           <td><tt>4.72</tt></td>
          </tr>
           <tr>
          <td><tt>log(solub.),yE</tt></td>
           <td><tt>-1.966</tt></td>
           <td><tt>-1.936</tt></td>
           <td><tt>-1.976</tt></td>
           <td><tt>-2.059</tt></td>
           <td><tt>-2.255</tt></td>
           <td><tt>-2.290</tt></td>
           <td><tt>-2.326</tt></td>
          </tr>
                                     
  </tbody>         
</table>
           </p>
                  
<p>When ready, save the record to database and plot the data again (<tt>"Record"
     "Plot"</tt>). Customize the graph (make scattered symbols of size 5,
line     type 0 for the experimental points). The experimentally determined
total    solubilities are significantly less than our model predictions at
total  0.6  &lt; <i>X</i> (Sr) &lt; 0.9, implying either inhibition of phase
separation    in this region or insufficient equilibration time in the experiments.
<br>
         &nbsp; </p>
                  
<p>It is now interesting to see how compositions of both solid solution phases 
    change with total <i>X</i> (Sr) in solid. It is easy - we just have to 
 "clone"&nbsp;   the previously created GtDemo record and change some parts 
 in the sampler   definition. In the "Record" menu, select <tt>"Save as"</tt> 
 , change the  record key to "<tt>Default:SysEq:GT:1:CaSrCO3SS_sx:"</tt>, 
press <tt>"Ok"</tt>  and then select <tt>"Record" "Remake"</tt> menu item. 
Select "SysEq" in the  appearing list, press <tt>"Ok"</tt> and again <tt>"Remake"</tt> 
 button. Now  we need four lines for mole fractions of two end members in 
two phases, and  we will not plot any experimental points. So, find the <tt>gDimXY[0,1]</tt> 
    cell and enter 6 there, then enter zeros into <tt>gDimEf[0,0]</tt> and 
 <tt>gDimEf[0,1]   </tt>fields, and turn off (to <tt>'-'</tt>) the <tt>GDps[0,0]</tt> 
 flag.   Press <tt>"Ok"</tt> when finished. The record key template and list 
 of SysEq   record keys appear again, all the keys are already selected, simply
  press   <tt>"Ok"</tt>. In the "GtDemo" window, change GDname field to:
<br>
         &nbsp; </p>
                  
<blockquote><tt>Mole fractions of Ca and Sr end members in SS phases</tt></blockquote>
                     
<p><br>
         Put <tt>"Mol fr."</tt> to <tt>gY_Nam</tt> field. Six entries in
<tt>gLnam</tt>      list can be changed to <tt>"X1Ca", "X1Sr", "X2Ca", "X2Sr",
"mX1,g", "mX2,g".      </tt>There are many ways to write a math script for
picking up mole fractions     of solid solution end members; here is just
one of them, in tune with the    previous script: <br>
         &nbsp; </p>
                  
<blockquote><tt>$ Determine total Sr mole fraction % in solid</tt> <br>
           <tt>x0[jR] =: ( b[\i{Sr}] - bXa[0][{Sr}] ) *100 /</tt> <br>
           <tt>&nbsp; ( b[{Sr}] - bXa[0][{Sr}] + b[{Ca}] - bXa[0][{Ca}] );</tt> 
     <br>
           <tt>$ Collect % mole fractions of Ca and Sr in SS phases</tt>
  <br>
           <tt>y0[jR][0] =: Wxx[\j{oxygen}+1]*100;</tt> <br>
           <tt>y0[jR][1] =: Wxx[{oxygen}+2]*100;</tt> <br>
           <tt>y0[jR][2] =: Wxx[{oxygen}+3]*100;</tt> <br>
           <tt>y0[jR][3] =: Wxx[{oxygen}+4]*100;</tt> <br>
           <tt>$ Masses of SS phases in grams</tt> <br>
           <tt>y0[jR][4] =: phM[2];</tt> <br>
           <tt>y0[jR][5] =: phM[3];</tt> <br>
           <tt>$ End</tt></blockquote>
                     
<p><br>
         <tt>Wxx</tt> is the data vector containing calculated mole fractions 
  for   species in multi-component phases. The <tt>oxygen</tt> gas stays in
  the DC  list just before aragonite end member of the first solid solution 
  phase,  and this name is used in the script to avoid warnings that there 
 are two species named "<tt>aragonite</tt>". <tt>phM</tt> is a vector containing 
  masses of phases (see <tt>EqPh</tt> page of "EqDemo" window). Put this script
  into <tt>gExpr</tt> field (remove old contents before) and run the data
sampler  by clicking on the <tt>"Calculate"</tt> icon. When finished, plot
the data  and customize the graph (assign different colors to lines, adjust
the grid  and so on). <br>
         &nbsp; </p>
                 Take a look first at the <tt>"mX1,g" </tt>and<tt> "mX2,g"</tt> 
lines showing     amounts of Ca-strontianite and Sr-aragonite phases, respectively. 
Both  phases   co-exist in a wide region of total <i>X</i> (Sr)&nbsp; values 
from  0.5 to   86 %, where the quantity of the first one increases and that 
of the second   one decreases, while mole fractions of end-member remain fixed
(i.e. fill   out a miscibility gap at very low Sr content in aragonite and
ca. 14% CaCO<sub>3</sub>   in strontianite). At&nbsp; <i>X</i> (Sr) = 86%,
the Sr-aragonite phase disappears   and mole fractions of end-members in
Ca-strontianite change linearly towards   composition of pure strontianite; 
quantity of this phase now practically  remains constant. <br>
 <br>
 
<p>&nbsp; <br>
         &nbsp; <br>
         &nbsp; </p>
                  
<h4> <a name="3_2_1_set_process"></a></h4>
 <br>
 <br>
 <br>
 <br>
   
<p><br>
  </p>
   
<p><br>
  </p>
   
<p><br>
  </p>
   
<p><br>
  </p>
   
<p>         Then we will add sulfur to the system (and extend the thermodynamic 
 database   accordingly) to explore how the solid solution - aqueous solution 
 (SSAS)  equilibria involving (Ca,Sr)CO<sub>3</sub> solid solutions would 
change due  to precipitation of SrSO<sub>4</sub> phase (celestite). <br>
   </p>
     
<p><br>
   <br>
    </p>
     
<p><tt>end of file</tt> <br>
   &nbsp; </p>
   <br>
   <br>
  <br>
 <br>
</body>
</html>
